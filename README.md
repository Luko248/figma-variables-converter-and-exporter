# Figma CSS Variables Converter (Supernova Format)

A Figma plugin that converts Figma variables to **Supernova-compatible** SCSS token files and automatically pushes them to a GitHub repository. This plugin replaces Supernova's export functionality with a direct Figma-to-GitHub workflow.

## Core Functionality

### 1. ðŸŽ¯ **Figma Dev Mode Integration**

The plugin updates Figma's web/devmode to display properly formatted CSS variable names:

- **Before:** Generic variable display
- **After:** Shows `var(--colorPrimary500)`, `var(--measuresSpacing16)` format
- **Benefit:** Developers see the exact Supernova-style variable names they need to use in their code

### 2. ðŸ“¤ **GitHub SCSS Export (Supernova Format)**

Automatically generates and exports multiple categorized SCSS files to your GitHub repository:

- **Format:** Supernova-compatible SCSS files with mixins
- **Output:** Organized SCSS files by category (`_colors.scss`, `_measures.scss`, `_fonts.scss`, etc.)
- **Integration:** Direct push to specified GitHub repo/branch/folder

## Features

- ðŸŽ¨ **Modern Color Format:** OKLCH colors (`oklch(0.7 0.15 180)`) with alpha (`oklch(0.7 0.15 180 / 0.5)`) powered by [Colorizr](https://www.npmjs.com/package/colorizr)
- ðŸ“ **Rem Units:** All sizes converted to rem units (16px base: `1rem`, `0.5rem`, etc.)
- ðŸ·ï¸ **Semantic Naming:** Variable names with category prefixes (`--colorPrimary500`, `--measuresSpacing16`)
- ðŸ”„ **Auto Type Detection:** Detects colors, measures, fonts, shadows, gradients
- ï¿½ **Multi-Theme Support:** Automatically detects Figma variable modes and creates theme-specific folders
- ï¿½ðŸŽ­ **CamelCase Preservation:** Maintains camelCase naming convention
- ðŸ“¤ **GitHub Integration:** Direct push to repository with organized file structure
- ðŸ—ï¸ **Clean Architecture:** Modular TypeScript with lambda functions
- ðŸ”§ **Secure Configuration:** JSON-based config with token management

## Example Output

### Generated SCSS Files Structure

**Single Theme:**

```text
theme/
â”œâ”€â”€ _color.scss
â”œâ”€â”€ _measures.scss  
â”œâ”€â”€ _fonts.scss
â”œâ”€â”€ _shadows.scss
â”œâ”€â”€ _gradient.scss
â”œâ”€â”€ __index.scss
â””â”€â”€ _root.scss
```

**Multiple Themes:**

```text
lighttheme/
â”œâ”€â”€ _color.scss
â”œâ”€â”€ _measures.scss
â”œâ”€â”€ _fonts.scss
â”œâ”€â”€ _shadows.scss
â”œâ”€â”€ _gradient.scss
â”œâ”€â”€ __index.scss
â””â”€â”€ _root.scss
darktheme/
â”œâ”€â”€ _color.scss
â”œâ”€â”€ _measures.scss
â”œâ”€â”€ _fonts.scss
â”œâ”€â”€ _shadows.scss
â”œâ”€â”€ _gradient.scss
â”œâ”€â”€ __index.scss
â””â”€â”€ _root.scss
```### Sample `_color.scss` Format

```scss
/*
* COLORS TOKENS GENERATED BY FIGMA CSS VARIABLES CONVERTER
*---------------------------------------------
*
* Exported at: 10/6/2025 2:30:45 PM
* File: colors.scss
* Type: COLORS
*/

@mixin create-color {

/* --- primary --- */
  --colorPrimary100: oklch(0.961 0.013 180.3);
  --colorPrimary200: oklch(0.921 0.017 184.2);
  --colorPrimary500: oklch(0.702 0.131 173.8);
  --colorPrimary900: oklch(0.422 0.089 181.4);

/* --- secondary --- */
  --colorSecondary100: oklch(0.982 0.003 210.1);
  --colorSecondary500: oklch(0.712 0.012 210.5);
  --colorSecondary900: oklch(0.151 0.008 210.2);
}
```

### Sample `_measures.scss` Format

```scss
@mixin create-measures {

/* --- spacing --- */
  --measuresSpacing4: 0.25rem;
  --measuresSpacing8: 0.5rem;
  --measuresSpacing16: 1rem;
  --measuresSpacing24: 1.5rem;

/* --- borderRadius --- */
  --measuresBorderRadius4: 0.25rem;
  --measuresBorderRadius8: 0.5rem;
}
```

### Figma Dev Mode Display

- **primaryColor** â†’ `var(--colorPrimary500)`
- **spacing16** â†’ `var(--measuresSpacing16)`
- **borderRadius** â†’ `var(--measuresBorderRadius8)`

## Multi-Theme Support

The plugin automatically detects Figma variable modes (themes) and organizes tokens accordingly:

### Theme Detection

- **Single Mode:** Creates a `theme/` folder
- **Multiple Modes:** Creates folders named after each mode in lowercase (e.g., `lighttheme/`, `darktheme/`)
- **Mode Names:** Uses Figma's mode names or falls back to "Mode 1", "Mode 2", etc.

### Theme Organization

- Each theme folder contains the complete SCSS structure
- Variables are generated with mode-specific values
- Consistent naming across all themes
- Each theme is self-contained with its own mixins

### Example Multi-Theme Output

```scss
// lighttheme/_color.scss
@mixin create-color {
  --colorPrimary500: oklch(0.702 0.131 173.8);
  --colorBackground: oklch(0.99 0.005 180);
}

// darktheme/_color.scss  
@mixin create-color {
  --colorPrimary500: oklch(0.702 0.131 173.8);
  --colorBackground: oklch(0.15 0.008 180);
}
```

## Source Code Structure

The plugin uses a modular architecture with lambda functions and clean separation of concerns:

### `utils.ts`

- **OKLCH Color Conversion:** `rgbToOklch()`, `rgbaToOklch()` with alpha support
- **Unit Conversion:** `pxToRem()` for consistent rem units
- **GitHub Integration:** `base64Encode()` for API compatibility

### `variable-detectors.ts`

- **Smart Type Detection:** Lambda functions for detecting variable purposes
- **Semantic Naming:** `generateCSSVariableName()` with camelCase conversion
- **Type Mapping:** Clean prefix mapping for CSS variable categories

### `css-generator.ts`

- **Value Conversion:** Type-specific CSS value generation
- **Output Formatting:** Organized CSS with proper grouping and comments
- **Modern Syntax:** OKLCH colors, rem units, alpha support

### `github-service.ts`

- **Repository Integration:** File upload with conflict resolution
- **Error Handling:** Comprehensive API error management
- **Security:** Token masking and secure authentication

### `main.ts`

- **Workflow Orchestration:** Complete plugin lifecycle management
- **Figma Integration:** Dev mode syntax updates with `setVariableCodeSyntax()`
- **User Feedback:** Progressive notifications for better UX

## Configuration

The plugin uses a JSON-based configuration system for better security and maintainability.

### Setup Instructions

1. **Create your config file**: Copy `config.example.json` to `config.json`:

   ```bash
   cp config.example.json config.json
   ```

2. **GitHub Token**: Create a personal access token at [GitHub Settings > Developer settings > Personal access tokens](https://github.com/settings/tokens)

   - Select "Generate new token (classic)"
   - Give it a descriptive name like "Figma Variables Plugin"
   - Select the `repo` scope for repository access
   - Copy the generated token

3. **Update Configuration**: Edit `config.json` with your settings:

   ```json
   {
     "github": {
       "owner": "your-github-username",
       "repo": "your-repository-name",
       "path": "path/to/scss/folder",
       "branch": "main",
       "token": "your-github-token-here"
     }
   }
   ```

### Configuration Structure

- **`github.owner`**: Your GitHub username or organization
- **`github.repo`**: Target repository name
- **`github.path`**: Folder path where SCSS files will be saved (e.g., "src/tokens" or "design-tokens")
- **`github.branch`**: Target branch (usually "main" or "master")
- **`github.token`**: Your GitHub personal access token

### Security Notes

- âœ… `config.json` is automatically ignored by Git (in `.gitignore`)
- âœ… Use `config.example.json` as a template for team sharing
- âœ… Never commit your actual `config.json` with tokens to version control
- âœ… The build process injects config at compile time, keeping it secure

## Build Process

The plugin uses a modern modular build process with secure configuration injection:

1. **Modular Structure**: Source code is organized in the `src/` directory with separate modules
2. **Config Injection**: `npm run prebuild` reads `config.json` and injects it into `src/config.ts`
3. **Bundling**: `npm run build` uses `@vercel/ncc` to bundle all TypeScript modules into a single `code.js` file
4. **Single File Output**: The build creates a single `code.js` file compatible with Figma's plugin environment

### Source Structure

```text
src/
â”œâ”€â”€ main.ts              # Main plugin entry point
â”œâ”€â”€ config.ts            # Configuration (injected from config.json)
â”œâ”€â”€ types.ts             # Figma API type definitions
â”œâ”€â”€ utils.ts             # Utility functions (base64, color conversion)
â”œâ”€â”€ variable-detectors.ts # Variable type detection and naming
â”œâ”€â”€ css-generator.ts     # CSS generation logic
â””â”€â”€ github-service.ts    # GitHub API integration
```

### Available Scripts

- `npm run build` - Full build (config injection + bundling)
- `npm run prebuild` - Only inject config from JSON into TypeScript
- `npm run config` - Alias for prebuild (config injection only)
- `npm run clean` - Remove generated `code.js` file and build artifacts
- `npm run watch` - Watch mode for development with auto-rebuild

### Development Workflow

1. Edit source files in the `src/` directory
2. Run `npm run build` to bundle everything into `code.js`
3. Test the plugin in Figma
4. Use `npm run watch` for continuous development
5. Use `npm run clean` to remove generated files when needed

## Variable Format Examples

| Figma Variable    | CSS Variable Name              | CSS Value Example   | File Location |
| ----------------- | ------------------------------ | ------------------- | ------------- |
| `primaryColor`    | `--colorPrimaryColor`         | `oklch(0.7 0.15 220)` | `_color.scss` |
| `spacing16`       | `--measuresSpacing16`          | `1rem`              | `_measures.scss` |
| `borderRadius`    | `--measuresBorderRadius`       | `0.25rem`           | `_measures.scss` |
| `fontWeightBold`  | `--fontsFontWeightBold`        | `700`               | `_fonts.scss` |
| `shadowElevation` | `--shadowsShadowElevation`     | `0 0.5rem 1rem ...` | `_shadows.scss` |
| `gradientPrimary` | `--gradientGradientPrimary`   | `linear-gradient()` | `_gradient.scss` |

## Usage Notifications

When the plugin runs, you'll see two notifications:

1. **"âœ… X variables converted to Supernova-friendly format"** - Figma dev mode updated
2. **"âœ… Success! X variables pushed to GitHub in Supernova format"** - SCSS files exported to repository

## Development

### Building the Plugin

```bash
npm run build
```

### Linting

```bash
npm run lint
npm run lint:fix
```

### Watching for Changes

```bash
npm run watch
```

## Technical Highlights

- **Lambda Functions:** Clean, functional programming approach
- **Type Safety:** Comprehensive TypeScript interfaces
- **Single Bundle:** 19KB optimized output for Figma
- **Modern CSS:** OKLCH colors, rem units, semantic naming
- **Error Handling:** Robust error management and user feedback
- **Security:** Secure token handling and Git integration

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## Author

Lukas Chylik
